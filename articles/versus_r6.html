<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Q7">
<title>Comparison to R6 • Q7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison to R6">
<meta property="og:description" content="Q7">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Q7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/examples.html">More Examples</a>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to Q7 Type System</a>
    <a class="dropdown-item" href="../articles/oop4r.html">oop4r</a>
    <a class="dropdown-item" href="../articles/oop_shiny.html">OOP for Shiny</a>
    <a class="dropdown-item" href="../articles/versus_r6.html">Comparison to R6</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iqis/Q7/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Comparison to R6</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iqis/Q7/blob/HEAD/vignettes/versus_r6.Rmd" class="external-link"><code>vignettes/versus_r6.Rmd</code></a></small>
      <div class="d-none name"><code>versus_r6.Rmd</code></div>
    </div>

    
    
<p>Q7 is expected to be compared with R6, the premier object facility in
R. Q7 covers the majority of R6 capabilities. The main difference is
that Q7 promotes compositional object construction, instead of
hereditary.</p>
<ul>
<li>Compositonal: I put a plasma cannon on my spaceship, then expanded
the cargo area.</li>
<li>Hereditary: I made my spaceship a special kind of spaceship that has
a plasma cannon, then made it more special with an expanded cargo
area.</li>
</ul>
<div class="section level4">
<h4 id="terminologies">Terminologies<a class="anchor" aria-label="anchor" href="#terminologies"></a>
</h4>
<p>The blueprint for an <em>object</em>: - R6: a class - Q7: a type</p>
<p>The object which creates instances from the blueprint - R6: a
generator - within, a <code>$new()</code> method - Q7: a constructor
function</p>
<p>Functions defined inside an object - R6: a method - Q7: - a bound
function (as opposed to a free function) - a domestic function (as
opposed to a foreign function)</p>
<p>The following is the equivalent to examples from R6’s <a href="https://r6.r-lib.org/articles/Introduction.html" class="external-link">Introduction</a>,
leaving out original comments &amp; explainations.</p>
<p>You can compare the the implementation of R6 and Q7 side-by-side.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://henninglorenzen-ext-bayer.github.io/Q7/">Q7</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Q7'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     merge</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basics">
<a href="https://r6.r-lib.org/articles/Introduction.html#basics" class="external-link">Basics</a><a class="anchor" aria-label="anchor" href="#basics"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Person</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">hair</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">name</span></span>
<span>  <span class="va">hair</span> <span class="op">&lt;-</span> <span class="va">hair</span></span>
<span>  <span class="va">set_hair</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">hair</span> <span class="op">&lt;&lt;-</span> <span class="va">val</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">greet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, my name is "</span>, <span class="va">name</span>, <span class="st">".\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, <span class="st">"Person"</span><span class="op">)</span></span>
<span><span class="va">Person</span></span>
<span><span class="co">#&gt; &lt;Q7type:Person&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span> <span class="op">&lt;-</span> <span class="fu">Person</span><span class="op">(</span><span class="st">"Ann"</span>, <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">ann</span></span>
<span><span class="co">#&gt; &lt;Q7instance:Person&gt;</span></span>
<span><span class="co">#&gt; - greet: &lt;function&gt;</span></span>
<span><span class="co">#&gt; - hair: &lt;character&gt;</span></span>
<span><span class="co">#&gt; - name: &lt;character&gt;</span></span>
<span><span class="co">#&gt; - set_hair: &lt;function&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span><span class="op">$</span><span class="va">hair</span></span>
<span><span class="co">#&gt; [1] "black"</span></span>
<span><span class="va">ann</span><span class="op">$</span><span class="fu">greet</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hello, my name is Ann.</span></span>
<span><span class="va">ann</span><span class="op">$</span><span class="fu">set_hair</span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">ann</span><span class="op">$</span><span class="va">hair</span></span>
<span><span class="co">#&gt; [1] "red"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="private-members">
<a href="https://r6.r-lib.org/articles/Introduction.html#private-members" class="external-link">Private
members</a><a class="anchor" aria-label="anchor" href="#private-members"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Queue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">queue</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">length</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">queue</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">queue</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">queue</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">.my</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">remove</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">head</span> <span class="op">&lt;-</span> <span class="va">queue</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">queue</span> <span class="op">&lt;&lt;-</span> <span class="va">queue</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">head</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">dots</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> </span>
<span>  <span class="co"># this is necessary because ... (dot-dot-dot) must be captured here, and that </span></span>
<span>  <span class="co"># the initialize() function must not take any arguments.</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">initialize</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">item</span> <span class="kw">in</span> <span class="va">dots</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">add</span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu">Queue</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="st">"foo"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"something"</span><span class="op">)</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"another thing"</span><span class="op">)</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">17</span><span class="op">)</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span><span class="op">$</span><span class="va">queue</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">length</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): attempt to apply non-function</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">11</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "foo"</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "something"</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "another thing"</span></span>
<span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 17</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="active-bindings">
<a href="https://r6.r-lib.org/articles/Introduction.html#active-bindings" class="external-link">Active
Bindings</a><a class="anchor" aria-label="anchor" href="#active-bindings"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Numbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="va">active</span><span class="op">[</span><span class="va">x2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="kw">else</span> <span class="va">x</span> <span class="op">&lt;&lt;-</span> <span class="va">value</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">active</span><span class="op">[</span><span class="va">rand</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, <span class="st">"Numbers"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">Numbers</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] 100</span></span>
<span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">x2</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] 500</span></span>
<span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">rand</span></span>
<span><span class="co">#&gt; [1] 1.10535</span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">rand</span></span>
<span><span class="co">#&gt; [1] 1.113476</span></span>
<span><span class="va">n</span><span class="op">$</span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="co">#&gt; Error in (function () : unused argument (base::quote(3))</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HistoryQueue</span> <span class="op">&lt;-</span> <span class="va">Queue</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/implement.html">implement</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">head_idx</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="va">show</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Next item is at index"</span>, <span class="va">head_idx</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">queue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">": "</span>, <span class="va">queue</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">remove</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">head_idx</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>      <span class="va">head_idx</span> <span class="op">&lt;&lt;-</span> <span class="va">head_idx</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">queue</span><span class="op">[[</span><span class="va">head_idx</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hq</span> <span class="op">&lt;-</span> <span class="fu">HistoryQueue</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="st">"foo"</span><span class="op">)</span></span>
<span><span class="va">hq</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Next item is at index 1 </span></span>
<span><span class="co">#&gt; 1: 5</span></span>
<span><span class="co">#&gt; 2: 6</span></span>
<span><span class="co">#&gt; 3: foo</span></span>
<span><span class="va">hq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="va">hq</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Next item is at index 2 </span></span>
<span><span class="co">#&gt; 1: 5</span></span>
<span><span class="co">#&gt; 2: 6</span></span>
<span><span class="co">#&gt; 3: foo</span></span>
<span><span class="va">hq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>NOTE: There is no inheritance in Q7, so you cannot call methods of
your parent class. But you can rename anything you don’t meant to
override.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CountingQueue</span> <span class="op">&lt;-</span> <span class="va">Queue</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/implement.html">implement</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">total</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">proto.add</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">add</span> </span>
<span>  </span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">total</span> <span class="op">&lt;&lt;-</span> <span class="va">total</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="fu">proto.add</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>      </span>
<span>  <span class="va">get_total</span> <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">total</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cq</span> <span class="op">&lt;-</span> <span class="fu">CountingQueue</span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">cq</span><span class="op">$</span><span class="fu">get_total</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="va">cq</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span></span>
<span><span class="va">cq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="va">cq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "y"</span></span>
<span><span class="va">cq</span><span class="op">$</span><span class="fu">get_total</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fields-containing-reference-objects">
<a href="https://r6.r-lib.org/articles/Introduction.html#fields-containing-reference-objects" class="external-link">Fields
containing reference objects</a><a class="anchor" aria-label="anchor" href="#fields-containing-reference-objects"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SimpleClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="op">}</span>, <span class="st">"SimpleClass"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SharedField</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">SimpleClass</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="st">"SharedField"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">SharedField</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">SharedField</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">s2</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Q7 and R6 again show differnet behavior. In Q7’s case,
<code>s1</code>’s <code>x</code> isn’t changed with that of
<code>s2</code>. The <code>x</code> in the R6 example lives with the
generator; the <code>x</code> in Q7 lives with the instance. The R6
example goes on to show a solution with an separate initializer; the
same this not necessary in Q7, as the type definition itself is its
initializer(a separate <code>initialize()</code> subroutine can be
defined to run once at an object’s initialization).</p>
</div>
<div class="section level3">
<h3 id="other-topics">
<a href="https://r6.r-lib.org/articles/Introduction.html#other-topics" class="external-link">Other
topics</a><a class="anchor" aria-label="anchor" href="#other-topics"></a>
</h3>
<div class="section level4">
<h4 id="adding-members-to-an-existing-class">Adding members to an existing class<a class="anchor" aria-label="anchor" href="#adding-members-to-an-existing-class"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">getx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, <span class="st">"Simple"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="va">Simple</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/implement.html">implement</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">getx2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="va">Simple</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/implement.html">implement</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Simple</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">s</span><span class="op">$</span><span class="fu">getx2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>In Q7, new code is simply appened to the old, meaning everything will
be executed linearly from the beginning to the end. This make it
inefficient when you replace something costly to make, like reading in a
large amount of data or performing a lengthy calculation. In this case,
it’s best to make a new type from scratch, or define a common prototype
without the costly members.</p>
<p>Q7 type constructors need not (and cannot) be locked.</p>
</div>
<div class="section level4">
<h4 id="cloning-objects">Cloning Objects<a class="anchor" aria-label="anchor" href="#cloning-objects"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">getx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, <span class="st">"Simple"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Simple</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone.html">clone</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">s</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><strong>Deep Cloning</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span>, <span class="st">"Simple"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Cloneable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">Simple</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="st">"Cloneable"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu">Cloneable</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone.html">clone</a></span><span class="op">(</span><span class="va">c1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c1</span><span class="op">$</span><span class="va">s</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">c2</span><span class="op">$</span><span class="va">s</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>The default <code><a href="../reference/clone.html">clone()</a></code> behavior in Q7 is deep (recursive).
So any nested instances also gets cloned. Like in R6, only object
instances will be cloned deeply. The example of a custom
<code>deep_clone</code> method in the R6 document is skipped for
brevity.</p>
</div>
<div class="section level4">
<h4 id="printing-q7-objects-to-the-screen">Printing Q7 objects to the screen<a class="anchor" aria-label="anchor" href="#printing-q7-objects-to-the-screen"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prettyCountingQueue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/extend.html">extend</a></span><span class="op">(</span><span class="va">CountingQueue</span><span class="op">)</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">print</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&lt;PrettyCountingQueue&gt; of "</span>, <span class="fu">get_total</span><span class="op">(</span><span class="op">)</span>, <span class="st">" elements\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, <span class="st">"prettyCountingQueue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pq</span> <span class="op">&lt;-</span> <span class="fu">prettyCountingQueue</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">"foobar"</span><span class="op">)</span></span>
<span><span class="va">pq</span></span>
<span><span class="co">#&gt; &lt;PrettyCountingQueue&gt; of 3 elements</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="finalizers">Finalizers<a class="anchor" aria-label="anchor" href="#finalizers"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">private</span><span class="op">[</span><span class="va">finalize</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.my</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Finalizer has been called!"</span><span class="op">)</span></span>
<span>    <span class="co"># Must always qualify `print()` with package name `base`, </span></span>
<span>    <span class="co"># because it is masked by`print()` in the object masks</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">A</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Finalizer has been called!"</span></span>
<span><span class="co">#&gt;           used (Mb) gc trigger (Mb) max used (Mb)</span></span>
<span><span class="co">#&gt; Ncells  720540 38.5    1394571 74.5  1394571 74.5</span></span>
<span><span class="co">#&gt; Vcells 1279999  9.8    8388608 64.0  2464859 18.9</span></span></code></pre></div>
<p>For the finalizer function, you must define an argument
(<code>.my</code>, but could be any name) to represent the object
itself.</p>
</div>
<div class="section level4">
<h4 id="class-methods-vs--member-functions">Class methods vs. member functions<a class="anchor" aria-label="anchor" href="#class-methods-vs--member-functions"></a>
</h4>
<p>In Q7 context, <em>domestic functions vs foreign functions</em></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FunctionWrapper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/type.html">type</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">get_my</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">.my</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">FunctionWrapper</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">.my</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">a</span><span class="op">$</span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">.my</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">a</span><span class="op">$</span><span class="fu">get_my</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): attempt to apply non-function</span></span>
<span></span>
<span><span class="va">a</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone.html">clone</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">get_my</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): attempt to apply non-function</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Siqi Zhang, Bayer HealthCare.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
