---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# foo

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

Welcome! `foo` provides _Freestyle Object Oriented_ Programming, featuring:

- Native R Flavor
  - Everything is familiar
  - Use `<-` to assign value to bindings
  
- No Inheritance
  - No lineage to trace back to
  - No methods you don't need
  - No mess
  
- Compostable
  - _Reference Semantics_
  - instance can contain other instances
  - post-hoc `implement()` to add more custom features

- Unlocked environment/binding
  - Each object is an environment
  - use `.my` to refer to self (optional)
  - Deep copy by default
  - add, remove, change items in an object freely as you please
  - want immutability? don't write the code that changes things!

## Installation

``` r
# install.packages("devtools")
devtools::install_github("iqis/foo")
```
## Example

Walk through the following example and see if you can figure out how `foo` works.

```{r include=FALSE}
require(magrittr)
require(foo)
```


```{r}
dog <- type(function(name, breed){
    say <- function(greeting = "Woof!"){
        cat(paste0(greeting, 
                   " I am ", name, ", a ", breed, 
                   ".\n"))
    }    
})
```


```{r}
walter <- dog("Walter", "Husky")
ls(walter, all.names = TRUE)
```


```{r}
walter$say()
```

```{r}
max <- walter %>% clone()
max$name <- "Max"
max$say("Wussup Dawg!")
```

```{r}
max %>% 
  implement({
    treats_eaten <- 0
    eat_treat <- function(n = 1){
      cat(paste(name, "eats", n, "treat(s).\n"))
      treats_eaten <<- treats_eaten + n
    }
  }) %>% 
  implement({
    is_satisfied <- function(){
      treats_eaten > 5
    }
  })
```


```{r}
max$eat_treat()
max$is_satisfied()
max$eat_treat(2)
max$is_satisfied()
max$eat_treat(3)
max$is_satisfied()
```

```{r}
max$treats_eaten
```

```{r}
is_animal <- feature({
    mortal <- TRUE
    eat <- function() paste(.my$name, "eats.")
    poop <- function() paste(name, "poops")
})

max %>% 
  is_animal()

max$eat()
max$poop()
```

```{r}
person <- type(function(name, job) {
  description <- function(){
    paste(name, "works as a(n)", job)
  }
  is_animal()
})
archie <- person("Archie", "Analyst")
```


```{r}
archie$description()
archie$poop()
```

```{r}
has_collar <- feature({
  collar <- type(function(material, color){
    description <- function() {
      paste("is made of", material, "and in", color)
    }
  })
  
  take_for_a_walk <- function(){
    cat(name, "wears a collar that", collar$description(), "\n")
    cat("We're gonna go out for a walk!")
  }
})
```

```{r}
walter %>%
  has_collar() %>% 
  implement({
    collar <- collar("metal", "red")
  })
```


```{r}
walter$take_for_a_walk()
```

```{r}
employee <- type(function(weekly_hours){NULL}, s3 = "employee")
john <- employee(45)
```

```{r}
manager <- type(function(weekly_hours){NULL}, s3 = "manager")
mike <- manager(45)
```


```{r}
has_overtime <- function(x){
  UseMethod("has_overtime")
}
has_overtime.employee <- feature({
  is_overtime <- function() weekly_hours > 40
})
has_overtime.manager <- feature({
  is_overtime <- function() FALSE
})
```


```{r}
john %>% 
  has_overtime()
john$is_overtime()
```

```{r}
mike %>% 
  implement(has_overtime)
mike$is_overtime()
```


```{r}
boss <- type(function(weekly_hours){
  has_overtime.manager()
}, s3 = "boss")
jill <- boss(80)
jill$is_overtime()
```

```{r}
my_data <- list(a = 1, 
                add_to_a = function(value){
                  .my$a <- a + value
                })

my_data_obj <- list2inst(my_data)

my_data_obj$a
my_data_obj$add_to_a(20)
my_data_obj$a
```

TODO: what if features have same bidings? what to do then? 
- evaluate each feature to their own environment, each has the parent of .my, or inside .my
- let the user pick and choose what bindings to _import_
- prefix bidings with class name
